name: Build LaTeX PDF

# Trigger on push or pull request
on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write # IMPORTANT: This is needed to create/update the release

    steps:
      # 1️⃣ Check out the repo
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2️⃣ Compile LaTeX using latexmk
      - name: Compile LaTeX
        uses: xu-cheng/latex-action@v3
        with:
          root_file: main.tex        # your root LaTeX file
          latexmk_options: -pdf -interaction=nonstopmode

          # --- OPTIMIZATION ---
          # Provide an explicit list of all packages your document uses.
          # This is MUCH faster than installing everything.
          #
          # How to find your packages:
          # Look in your main.tex and preamble.tex for every \usepackage{...}
          # and add the package name to this list.
          packages: >-
            graphicx
            amsmath
            amssymb
            amsfonts
            enumitem
            gensymb
            titling
            tikz
            xcolor
            hyperref
            subfiles
            nicematrix
            braket
            quantikz

      # 3️⃣ Upload the resulting PDF as an artifact
      - name: Update Latest Release with PDF
        uses: softprops/action-gh-release@v1
        with:
          # This tag will be created/updated automatically. It won't clutter your git history.
          tag_name: latest
          name: "Latest PDF Build"
          body: "This release contains the most up-to-date PDF compiled from the main branch."
          # This will delete a previous release with the same tag and create a new one.
          prerelease: false
          # The file(s) to upload as assets to the release
          files: main.pdf

